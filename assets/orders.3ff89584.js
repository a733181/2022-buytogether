import{h as O,d as h,C as c,y as _,q as x,i as H,j as d,a4 as y}from"./index.e66c909f.js";const $=O("orders",()=>{const t=h({sellList:[],buyList:[],paid:{list:[],addressId:"",bankId:"",_id:""},adminList:[]}),i=h({list:{}}),L=c(()=>t.paid),b=c(()=>t.buyList),g=c(()=>t.sellList),f=c(()=>t.adminList),{cart:p}=_(x()),{swalSuccess:l,swalError:a}=H(),m=async e=>{try{const{data:s}=await d.post("/orders",e);p.value.length=0,t.paid.list=p.value.list,t.paid.addressId=e.addressId,t.paid.bankId=e.bankId,t.paid._id=s.result._id,l("\u4E0B\u55AE\u6210\u529F"),y.push("/paid")}catch(s){a(s)}},o=e=>{if(t.buyList.length){const s=t.buyList.findIndex(r=>r._id===e.result._id);t.buyList[s]=e.result,i.list&&(i.list=e.result)}if(t.sellList.length){const s=t.sellList.findIndex(r=>r._id===e.result._id);t.sellList[s]=e.result,i.list&&(i.list=e.result)}if(t.adminList.length){const s=t.adminList.findIndex(r=>r._id===e.result._id);t.adminList[s]=e.result,i.list&&(i.list=e.result)}};return{orderPaid:L,orderBuy:b,orderSell:g,orderAdmin:f,showProduct:i,checkouOrdertHandler:m,paidOrderHandler:async({orderId:e,productId:s})=>{try{const{data:r}=await d.patch(`/orders/${e}`,{productId:s,type:"paid"});if(s!==""&&t.paid.list.length>0){const n=t.paid.list.findIndex(u=>u.productId._id===s);t.paid.list[n].productId.paid=!0,t.paid.list.every(u=>u.productId.paid)&&y.push("/member/orderlist")}s===""&&y.push("/member/orderlist"),s!==""&&o(r),l("\u4ED8\u6B3E\u6210\u529F")}catch(r){a(r)}},shipOrderHandler:async({orderId:e,productId:s})=>{try{const{data:r}=await d.patch(`/orders/${e}`,{productId:s,type:"ship"});o(r),l("\u51FA\u8CA8\u6210\u529F")}catch(r){a(r)}},getMemberBuyOrderHandler:async()=>{try{const{data:e}=await d.get("/orders/buy");t.buyList=e.result}catch(e){a(e)}},getMemberSellOrderHandler:async()=>{try{const{data:e}=await d.get("/orders/sell");t.sellList=e.result}catch(e){a(e)}},getAdminOrder:async()=>{try{const{data:e}=await d.get("/orders/all");t.adminList=e.result}catch(e){a(e)}},changeStatusOrderHandler:async e=>{try{const{data:s}=await d.patch(`/orders/${e.id}`,e);if(t.buyList.length&&e.member==="buy"){const r=t.buyList.findIndex(n=>n._id===s.result._id);t.buyList[r]=s.result,i.list&&(i.list=s.result)}if(t.sellList.length&&e.member==="sell"){const r=t.sellList.findIndex(n=>n._id===s.result._id);t.sellList[r]=s.result,i.list&&(i.list=s.result)}e.status===0?l("\u53D6\u6D88\u5C01\u5B58\u6210\u529F"):e.status===1&&l("\u5C01\u5B58\u6210\u529F")}catch(s){a(s)}},cancelOrderHandler:async({orderId:e,productId:s})=>{const{data:r}=await d.patch(`/orders/${e}`,{productId:s,type:"cancel"});o(r)}}});export{$ as u};

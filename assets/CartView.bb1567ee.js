import{q as F,y as h,a2 as j,a3 as R,r as M,C as _,d as w,E as O,o as i,c as b,a as v,w as I,B as U,F as u,m as g,g as D,b as e,I as J,J as K,t as m,Z as C,f as P,K as Z,L as z}from"./index.96a46153.js";import{_ as G,a as Q,T as W}from"./TheMoreProduct.88377d38.js";import{_ as X}from"./delete.d6462d7c.js";import{v as N}from"./index.05e7650d.js";import{u as Y}from"./orders.f8419891.js";const ee={class:"container pt-44 lg:pt-32 pb-10"},te=e("p",{class:"text-primary font-bold"},"\u8CFC\u7269\u8ECA",-1),se={key:0,class:"text-2xl flex gap-8 justify-center"},re=e("h1",null,"\u8CFC\u7269\u8ECA\u5167\u6C92\u6709\u5546\u54C1",-1),ae=["onSubmit"],oe={class:"w-full"},ne=e("thead",null,[e("tr",null,[e("th",{class:"border-2 p-2"},"\u5716\u7247"),e("th",{class:"border-2 p-2"},"\u540D\u7A31"),e("th",{class:"border-2 p-2"},"\u6578\u91CF"),e("th",{class:"border-2 p-2"},"\u55AE\u50F9"),e("th",{class:"border-2 p-2"},"\u5C0F\u8A08"),e("th",{class:"border-2 p-2"},"\u522A\u9664")])],-1),le={class:"border-2 p-2"},de=["src","alt"],ce={class:"border-2 p-2 text-center"},ue={class:"border-2 p-2"},ie={class:"flex justify-center items-center gap-3 lg:gap-6"},pe=["onClick"],_e=["onClick"],be={class:"border-2 p-2 text-center"},ve={class:"border-2 p-2 text-center"},me={class:"border-2 p-2"},ke=["onClick"],fe=e("td",{colspan:"3"},null,-1),he=e("td",{class:"text-center p-4"},[e("p",null,"\u7E3D\u8A08")],-1),ge={class:"text-center p-4"},xe={colspan:"6"},ye={class:"w-1/2 ml-auto"},$e={colspan:"6"},we={class:"w-1/2 ml-auto"},Ie=e("td",{colspan:"4"},null,-1),Ce={colspan:"2"},Ae={__name:"CartView",setup(Ne){const x=F(),{getCartList:y,clickAddCartHandler:S,deleteCartHandler:B}=x,{cart:p}=h(x),{checkouOrdertHandler:V}=Y(),{listBank:l}=h(j()),{listAddress:a}=h(R());y();const k=M(!1),T=_(()=>{const s=a.value.findIndex(r=>r.preset);return s===-1&&a.value.length===0?"":s===-1?`${a.value[0].code} ${a.value[0].city} ${a.value[0].districts} ${a.value[0].street}`:`${a.value[s].code} ${a.value[s].city} ${a.value[s].districts} ${a.value[s].street}`}),L=_(()=>{const s=l.value.findIndex(r=>r.preset);return s===-1&&l.value.length===0?"":s===-1?`${l.value[0].bankName} - ${l.value[0].bankNumber}`:`${l.value[s].bankName} - ${l.value[s].bankNumber}`}),o=w({address:{error:!1,value:""},bank:{error:!1,value:""}}),d=w({address:T.value,bank:L.value}),f=async({id:s,quantity:r,type:n})=>{n!=="delete"?await S({id:s,quantity:r}):await B({id:s}),await y()},A=_(()=>p.value.list.reduce((s,r)=>s+r.productId.price*r.quantity,0)),q=_(()=>l.value.map(s=>`${s.bankName} - ${s.bankNumber}`)),H=_(()=>a.value.map(s=>`${s.code} ${s.city} ${s.districts} ${s.street}`)),E=()=>N.isEmpty(d.bank)?(o.bank.value="\u70BA\u5FC5\u586B",o.bank.error=!0,!0):N.isEmpty(d.address)?(o.address.value="\u70BA\u5FC5\u586B",o.address.error=!0,!0):l.value.some(n=>{const t=d.bank.split("-");return n.bankName===t[0].trim()&&n.bankNumber.toString()===t[1].trim()})?a.value.some(n=>{const t=d.address.split(" ");return n.code.toString()===t[0]&&n.city===t[1]&&n.districts===t[2]&&n.street.toString()===t[3]})?!1:(o.address.value="\u683C\u5F0F\u932F\u8AA4",o.address.error=!0,!0):(o.bank.value="\u683C\u5F0F\u932F\u8AA4",o.bank.error=!0,!0),$=async()=>{if(E())return;k.value=!0;const s=l.value.findIndex(t=>{const c=d.bank.split("-");return t.bankName===c[0].trim()&&t.bankNumber.toString()===c[1].trim()}),r=a.value.findIndex(t=>{const c=d.address.split(" ");return t.code.toString()===c[0]&&t.city===c[1]&&t.districts===c[2]&&t.street.toString()===c[3]}),n={addressId:a.value[r]._id,bankId:l.value[s]._id};await V(n),k.value=!1};return(s,r)=>{const n=O("RouterLink");return i(),b("div",ee,[v(U,{class:"mb-10"},{default:I(()=>[te]),_:1}),u(p).length?g("",!0):(i(),b("div",se,[re,v(n,{to:"/",class:"text-primary"},{default:I(()=>[z("\u524D\u5F80\u8CFC\u7269")]),_:1})])),u(p).length?(i(),b("form",{key:1,onSubmit:D($,["prevent"]),class:"mb-20"},[e("table",oe,[ne,e("tbody",null,[(i(!0),b(J,null,K(u(p).list,t=>(i(),b("tr",null,[e("td",le,[e("img",{src:t.productId.image,alt:t.productId.name,class:"w-1/2 mx-auto h-32 object-cover rounded-lg"},null,8,de)]),e("td",ce,[e("p",null,m(t.productId.name),1)]),e("td",ue,[e("div",ie,[e("img",{src:G,class:"w-5 hover:opacity-60",onClick:c=>f({id:t.productId._id,quantity:-1})},null,8,pe),e("p",null,m(t.quantity),1),e("img",{src:Q,class:"w-5 hover:opacity-60",onClick:c=>f({id:t.productId._id})},null,8,_e)])]),e("td",be,m(t.productId.price),1),e("td",ve,m(t.quantity*t.productId.price),1),e("td",me,[e("img",{src:X,class:"w-6 hover:opacity-60 mx-auto",onClick:c=>f({id:t.productId._id,type:"delete"})},null,8,ke)])]))),256)),e("tr",null,[fe,he,e("td",ge,[e("p",null,m(u(A)),1)])]),e("tr",null,[e("td",xe,[e("div",ye,[v(C,{modelValue:d.bank,"onUpdate:modelValue":r[0]||(r[0]=t=>d.bank=t),title:"\u4ED8\u6B3E\u5E33\u6236",select:u(q),error:o.bank.error,errorText:o.bank.value,onClick:r[1]||(r[1]=t=>o.bank.error=!1)},null,8,["modelValue","select","error","errorText"])])])]),e("tr",null,[e("td",$e,[e("div",we,[v(C,{modelValue:d.address,"onUpdate:modelValue":r[2]||(r[2]=t=>d.address=t),title:"\u6536\u4EF6\u5730\u5740",select:u(H),error:o.address.error,errorText:o.address.value,onClick:r[3]||(r[3]=t=>o.address.error=!1)},null,8,["modelValue","select","error","errorText"])])])]),e("tr",null,[Ie,e("td",Ce,[v(P,{text:"\u78BA\u5B9A",class:"w-full mt-6",onClick:$,disabled:k.value,loading:k.value},null,8,["disabled","loading"])])])])])],40,ae)):g("",!0),u(p).length?(i(),Z(W,{key:2,category:"\u5168\u90E8"})):g("",!0)])}}};export{Ae as default};

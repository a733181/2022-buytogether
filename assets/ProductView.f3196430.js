import{a1 as R,A as V,a4 as D,y as M,r as Y,e as N,E as f,G as j,a as b,c as k,b as i,w as T,B as q,d as l,a0 as p,H as c,M as w,h as g,q as C,K as A,L as G,i as K,N as z,t as J}from"./index.7a47915f.js";import{v as m}from"./index.18f3ce4a.js";import{i as L}from"./index.56345fb3.js";import{U as S}from"./UploadImage.7589b2a7.js";import{T as O}from"./TheTextarea.68db71b7.js";const Q={class:"container py-10"},W={class:"flex"},X=["onSubmit"],Z={class:"grid grid-cols-2 gap-5"},h=l("p",{class:"text-red-400"},"\uFF0A\u5168\u90E8\u6578\u91CF\u7121\u6CD5\u4FEE\u6539\uFF0C\u8ACB\u8B39\u614E\u586B\u5BEB",-1),ee={class:"flex gap-5 mb-8"},re={class:"flex-1"},te=l("p",{class:"text-red-400"},"\uFF0A\u9EDE\u9078\u6536\u6B3E\u5E33\u6236\uFF0C\u9078\u64C7\u6536\u6B3E\u5E33\u6236",-1),ae=l("p",{class:"text-red-400"},"\uFF0A\u9EDE\u9078\u5546\u54C1\u5206\u985E\uFF0C\u9078\u64C7\u5546\u54C1\u5206\u985E",-1),oe=l("p",{class:"mt-8 text-red-400"},"\uFF0A\u5546\u54C1\u5167\u6587\u5716\u7247\u6700\u591A\u53EF\u4E0A\u50B3 9\u5F35\u5716\u7247",-1),le={class:"mt-2 flex"},ie={class:"flex flex-wrap mt-10"},ue={class:"flex justify-between mt-8"},ce={__name:"ProductView",setup(ne){const $=R(),{productCategory:x}=$,{listBank:s}=V(D()),y=M(),{sumbitProductHandler:U,cancelProductHandler:B}=y,{editProduct:o}=V(y),v=Y(!1),t=N({image:{error:!1,value:""},name:{error:!1,value:""},price:{error:!1,value:""},maxNumber:{error:!1,value:""},description:{error:!1,value:""},bank:{error:!1,value:""},category:{error:!1,value:""},youtubeVideoLink:{error:!1,value:""}}),I=f(()=>s.value?s.value.map(u=>`${u.bankName} - ${u.bankNumber}`):[]),E=f(()=>{const u=s.value.findIndex(e=>e._id===o.value.bankId);return u===-1?"":`${s.value[u].bankName} - ${s.value[u].bankNumber}`}),_=f(()=>o.value.images?o.value.images.map(u=>({image:u})):[]),r=N({_id:o.value._id||"",name:o.value.name||"",price:o.value.price.toString()||"",maxNumber:o.value.maxNumber.toString()||"",description:o.value.description||"",image:o.value.image||"",images:[..._.value],bank:E.value,isSell:o.value.isSell||!1,category:o.value.category||"",youtubeVideoLink:o.value.youtubeId?`https://www.youtube.com/watch?v=${o.value.youtubeId}`:""}),H=()=>r.image===null||r.image===""?(t.image.value="\u70BA\u5FC5\u586B",t.image.error=!0,!0):m.isEmpty(r.name)?(t.name.value="\u70BA\u5FC5\u586B",t.name.error=!0,!0):m.isEmpty(r.price)?(t.price.value="\u70BA\u5FC5\u586B",t.price.error=!0,!0):m.isEmpty(r.maxNumber)?(t.maxNumber.value="\u70BA\u5FC5\u586B",t.maxNumber.error=!0,!0):m.isEmpty(r.description)?(t.description.value="\u70BA\u5FC5\u586B",t.description.error=!0,!0):m.isEmpty(r.bank)?(t.bank.value="\u70BA\u5FC5\u586B",t.bank.error=!0,!0):m.isEmpty(r.category)?(t.category.value="\u70BA\u5FC5\u586B",t.category.error=!0,!0):m.isNumeric(r.price)?m.isNumeric(r.maxNumber)?s.value.some(n=>{const a=r.bank.split("-");return n.bankName===a[0].trim()&&n.bankNumber.toString()===a[1].trim()})?x.some(n=>n===r.category)?r.youtubeVideoLink!==""&&!L.isVideo(r.youtubeVideoLink)?(t.youtubeVideoLink.value="\u7DB2\u5740\u932F\u8AA4",t.youtubeVideoLink.error=!0,!0):!1:(t.category.value="\u683C\u5F0F\u932F\u8AA4",t.category.error=!0,!0):(t.bank.value="\u683C\u5F0F\u932F\u8AA4",t.bank.error=!0,!0):(t.maxNumber.value="\u4E0D\u662F\u6578\u5B57",t.maxNumber.error=!0,!0):(t.price.value="\u4E0D\u662F\u6578\u5B57",t.price.error=!0,!0),P=async()=>{if(H())return;v.value=!0;const u=s.value.findIndex(a=>{const d=r.bank.split("-");return a.bankName===d[0].trim()&&a.bankNumber.toString()===d[1].trim()}),e=new FormData;e.append("_id",r._id),e.append("name",r.name),e.append("price",r.price),e.append("maxNumber",r.maxNumber),e.append("description",r.description),e.append("image",r.image),e.append("bankId",s.value[u]._id),e.append("isSell",r.isSell),e.append("category",r.category);const n=L.getVideoId(r.youtubeVideoLink);n&&e.append("youtubeId",n),r.images.length>=1&&r.images.forEach(a=>{e.append("images",a.image)}),await U(e),v.value=!1};return(u,e)=>{const n=j("RouterLink");return b(),k("div",Q,[i(q,{class:"mb-10"},{default:T(()=>[l("div",W,[i(n,{to:"/member/productlist",class:"text-primary font-bold hover:scale-105"},{default:T(()=>[z("\u5546\u54C1\u7BA1\u7406")]),_:1}),l("p",null,J(c(o)._id?"\u2002/\u2002\u4FEE\u6539\u5546\u54C1":"\u2002/\u2002\u65B0\u589E\u5546\u54C1"),1)])]),_:1}),l("form",{class:"lg:w-1/2 mx-auto space-y-5",onSubmit:K(P,["prevent"])},[i(p,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),title:"\u5546\u54C1\u540D\u7A31",error:t.name.error,errorText:t.name.value,onClick:e[1]||(e[1]=a=>t.name.error=!1)},null,8,["modelValue","error","errorText"]),l("div",Z,[i(p,{modelValue:r.price,"onUpdate:modelValue":e[2]||(e[2]=a=>r.price=a),title:"\u50F9\u683C",error:t.price.error,errorText:t.price.value,onClick:e[3]||(e[3]=a=>t.price.error=!1)},null,8,["modelValue","error","errorText"]),l("div",null,[i(p,{modelValue:r.maxNumber,"onUpdate:modelValue":e[4]||(e[4]=a=>r.maxNumber=a),title:"\u5168\u90E8\u6578\u91CF",error:t.maxNumber.error,errorText:t.maxNumber.value,onClick:e[5]||(e[5]=a=>t.maxNumber.error=!1),disabled:!!c(o).maxNumber},null,8,["modelValue","error","errorText","disabled"]),h])]),i(O,{modelValue:r.description,"onUpdate:modelValue":e[6]||(e[6]=a=>r.description=a),title:"\u5546\u54C1\u63CF\u8FF0",classText:"h-40",error:t.description.error,errorText:t.description.value,onClick:e[7]||(e[7]=a=>t.description.error=!1)},null,8,["modelValue","error","errorText"]),i(p,{modelValue:r.youtubeVideoLink,"onUpdate:modelValue":e[8]||(e[8]=a=>r.youtubeVideoLink=a),title:"Youtube\u5F71\u7247\u9023\u7D50",error:t.youtubeVideoLink.error,errorText:t.youtubeVideoLink.value,onClick:e[9]||(e[9]=a=>t.youtubeVideoLink.error=!1)},null,8,["modelValue","error","errorText"]),l("div",ee,[l("div",re,[i(p,{modelValue:r.bank,"onUpdate:modelValue":e[10]||(e[10]=a=>r.bank=a),title:"\u6536\u6B3E\u5E33\u6236",select:c(I),error:t.bank.error,errorText:t.bank.value,onClick:e[11]||(e[11]=a=>t.bank.error=!1)},null,8,["modelValue","select","error","errorText"]),te]),l("div",null,[i(p,{modelValue:r.category,"onUpdate:modelValue":e[12]||(e[12]=a=>r.category=a),title:"\u5546\u54C1\u5206\u985E",select:c(x),error:t.category.error,errorText:t.category.value,onClick:e[13]||(e[13]=a=>t.category.error=!1)},null,8,["modelValue","select","error","errorText"]),ae])]),i(S,{modelValue:r.image,"onUpdate:modelValue":e[14]||(e[14]=a=>r.image=a),title:"\u5546\u54C1\u4E3B\u5716",error:t.image.error,errorText:t.image.value,onClick:e[15]||(e[15]=a=>t.image.error=!1),id:"main-image"},null,8,["modelValue","error","errorText"]),oe,l("div",le,[!r.images.length||r.images.length<9?(b(),w(g,{key:0,text:"\u65B0\u589E\u5716\u7247",class:"w-1/4",onClick:e[16]||(e[16]=a=>r.images.push({image:""}))})):C("",!0),r.images.length>=1?(b(),w(g,{key:1,text:"\u522A\u9664\u4E00\u7B46",className:"btn-outline",class:"w-1/4 ml-auto",onClick:e[17]||(e[17]=a=>r.images.pop())})):C("",!0)]),l("div",ie,[(b(!0),k(A,null,G(r.images,(a,d)=>(b(),k("div",{key:d,class:"w-[30%] mt-4 ml-4"},[i(S,{modelValue:r.images[d].image,"onUpdate:modelValue":F=>r.images[d].image=F,id:`content-${d}`},null,8,["modelValue","onUpdate:modelValue","id"])]))),128))]),i(p,{title:"\u4E0A\u67B6",type:"checkbox",modelValue:r.isSell,"onUpdate:modelValue":e[18]||(e[18]=a=>r.isSell=a),id:"isSell"},null,8,["modelValue"]),l("div",ue,[i(g,{text:"\u53D6\u6D88",className:"btn-outline",class:"w-1/3",onClick:c(B)},null,8,["onClick"]),i(g,{type:"sumbit",text:"\u78BA\u5B9A",class:"w-1/3",disabled:v.value,loading:v.value},null,8,["disabled","loading"])])],40,X)])}}};export{ce as default};

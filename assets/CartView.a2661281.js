import{q as F,y as g,a2 as j,a3 as R,r as M,C as _,d as $,E as O,o as i,c as b,a as v,w as I,B as U,F as u,m as h,g as D,b as e,I as J,J as K,t as m,Z as C,f as P,K as Z,L as z}from"./index.705e8f7a.js";import{_ as G,a as Q,T as W}from"./TheMoreProduct.b9e9856f.js";import{_ as X}from"./delete.d6462d7c.js";import{v as N}from"./index.a9798279.js";import{u as Y}from"./orders.0a5f44ea.js";const ee={class:"container pt-44 lg:pt-32 pb-10 overflow-auto"},te=e("p",{class:"text-primary font-bold"},"\u8CFC\u7269\u8ECA",-1),se={key:0,class:"text-2xl flex gap-8 justify-center"},re=e("h1",null,"\u8CFC\u7269\u8ECA\u5167\u6C92\u6709\u5546\u54C1",-1),ae=["onSubmit"],oe={class:"overflow-auto"},le={class:"w-full table-fixed lg:table-auto"},ne=e("thead",null,[e("tr",null,[e("th",{class:"border-2 p-2 w-[150px] lg:w-auto"},"\u5716\u7247"),e("th",{class:"border-2 p-2 w-[100px] lg:w-auto"},"\u540D\u7A31"),e("th",{class:"border-2 p-2 w-[100px] lg:w-auto"},"\u6578\u91CF"),e("th",{class:"border-2 p-2 w-[100px] lg:w-auto"},"\u55AE\u50F9"),e("th",{class:"border-2 p-2 w-[100px] lg:w-auto"},"\u5C0F\u8A08"),e("th",{class:"border-2 p-2 w-[60px] lg:w-auto"},"\u522A\u9664")])],-1),de={class:"border-2 p-2"},ce=["src","alt"],ue={class:"border-2 p-2 text-center"},ie={class:"border-2 p-2"},pe={class:"flex justify-center items-center gap-3 lg:gap-6"},_e=["onClick"],be=["onClick"],ve={class:"border-2 p-2 text-center"},me={class:"border-2 p-2 text-center"},ke={class:"border-2 p-2"},fe=["onClick"],ge=e("td",{colspan:"3"},null,-1),he=e("td",{class:"text-center p-4"},[e("p",null,"\u7E3D\u8A08")],-1),xe={class:"text-center p-4"},we={class:"lg:w-1/3 lg:ml-auto"},ye={class:"lg:w-1/3 lg:ml-auto"},Ve={__name:"CartView",setup($e){const x=F(),{getCartList:w,clickAddCartHandler:S,deleteCartHandler:B}=x,{cart:p}=g(x),{checkouOrdertHandler:V}=Y(),{listBank:n}=g(j()),{listAddress:a}=g(R());w();const k=M(!1),T=_(()=>{const s=a.value.findIndex(r=>r.preset);return s===-1&&a.value.length===0?"":s===-1?`${a.value[0].code} ${a.value[0].city} ${a.value[0].districts} ${a.value[0].street}`:`${a.value[s].code} ${a.value[s].city} ${a.value[s].districts} ${a.value[s].street}`}),L=_(()=>{const s=n.value.findIndex(r=>r.preset);return s===-1&&n.value.length===0?"":s===-1?`${n.value[0].bankName} - ${n.value[0].bankNumber}`:`${n.value[s].bankName} - ${n.value[s].bankNumber}`}),o=$({address:{error:!1,value:""},bank:{error:!1,value:""}}),d=$({address:T.value,bank:L.value}),f=async({id:s,quantity:r,type:l})=>{l!=="delete"?await S({id:s,quantity:r}):await B({id:s}),await w()},A=_(()=>p.value.list.reduce((s,r)=>s+r.productId.price*r.quantity,0)),q=_(()=>n.value.map(s=>`${s.bankName} - ${s.bankNumber}`)),H=_(()=>a.value.map(s=>`${s.code} ${s.city} ${s.districts} ${s.street}`)),E=()=>N.isEmpty(d.bank)?(o.bank.value="\u70BA\u5FC5\u586B",o.bank.error=!0,!0):N.isEmpty(d.address)?(o.address.value="\u70BA\u5FC5\u586B",o.address.error=!0,!0):n.value.some(l=>{const t=d.bank.split("-");return l.bankName===t[0].trim()&&l.bankNumber.toString()===t[1].trim()})?a.value.some(l=>{const t=d.address.split(" ");return l.code.toString()===t[0]&&l.city===t[1]&&l.districts===t[2]&&l.street.toString()===t[3]})?!1:(o.address.value="\u683C\u5F0F\u932F\u8AA4",o.address.error=!0,!0):(o.bank.value="\u683C\u5F0F\u932F\u8AA4",o.bank.error=!0,!0),y=async()=>{if(E())return;k.value=!0;const s=n.value.findIndex(t=>{const c=d.bank.split("-");return t.bankName===c[0].trim()&&t.bankNumber.toString()===c[1].trim()}),r=a.value.findIndex(t=>{const c=d.address.split(" ");return t.code.toString()===c[0]&&t.city===c[1]&&t.districts===c[2]&&t.street.toString()===c[3]}),l={addressId:a.value[r]._id,bankId:n.value[s]._id};await V(l),k.value=!1};return(s,r)=>{const l=O("RouterLink");return i(),b("div",ee,[v(U,{class:"mb-10"},{default:I(()=>[te]),_:1}),u(p).length?h("",!0):(i(),b("div",se,[re,v(l,{to:"/",class:"text-primary"},{default:I(()=>[z("\u524D\u5F80\u8CFC\u7269")]),_:1})])),u(p).length?(i(),b("form",{key:1,onSubmit:D(y,["prevent"]),class:"mb-20"},[e("div",oe,[e("table",le,[ne,e("tbody",null,[(i(!0),b(J,null,K(u(p).list,t=>(i(),b("tr",null,[e("td",de,[e("img",{src:t.productId.image,alt:t.productId.name,class:"w-32 h-32 mx-auto object-cover rounded-lg"},null,8,ce)]),e("td",ue,[e("p",null,m(t.productId.name),1)]),e("td",ie,[e("div",pe,[e("img",{src:G,class:"w-5 hover:opacity-60",onClick:c=>f({id:t.productId._id,quantity:-1})},null,8,_e),e("p",null,m(t.quantity),1),e("img",{src:Q,class:"w-5 hover:opacity-60",onClick:c=>f({id:t.productId._id})},null,8,be)])]),e("td",ve,m(t.productId.price),1),e("td",me,m(t.quantity*t.productId.price),1),e("td",ke,[e("img",{src:X,class:"w-6 hover:opacity-60 mx-auto",onClick:c=>f({id:t.productId._id,type:"delete"})},null,8,fe)])]))),256)),e("tr",null,[ge,he,e("td",xe,[e("p",null,m(u(A)),1)])])])])]),e("div",we,[v(C,{modelValue:d.bank,"onUpdate:modelValue":r[0]||(r[0]=t=>d.bank=t),title:"\u4ED8\u6B3E\u5E33\u6236",select:u(q),error:o.bank.error,errorText:o.bank.value,onClick:r[1]||(r[1]=t=>o.bank.error=!1)},null,8,["modelValue","select","error","errorText"])]),e("div",ye,[v(C,{modelValue:d.address,"onUpdate:modelValue":r[2]||(r[2]=t=>d.address=t),title:"\u6536\u4EF6\u5730\u5740",select:u(H),error:o.address.error,errorText:o.address.value,onClick:r[3]||(r[3]=t=>o.address.error=!1)},null,8,["modelValue","select","error","errorText"])]),v(P,{text:"\u78BA\u5B9A",class:"w-3/12 lg:w-2/12 mt-6 ml-auto block",onClick:y,disabled:k.value,loading:k.value},null,8,["disabled","loading"])],40,ae)):h("",!0),u(p).length?(i(),Z(W,{key:2,category:"\u5168\u90E8"})):h("",!0)])}}};export{Ve as default};
